---
- name: Include secret vars
  include_vars:
    file: secrets.yml


- name: Generate hosts file
  ansible.builtin.template:
    src=hosts.j2
    dest=/etc/hosts
    
- name: Copy HR files over
  ansible.builtin.copy: 
    src: HR
    dest: /var/tmp/
    owner: tomcat
    group: tomcat
    mode: '0644'

- name: Copy LDAP files over
  ansible.builtin.copy: 
    src: EnterpriseDirectory
    dest: /var/tmp/
    owner: tomcat
    group: tomcat
    mode: '0644'

- name: Setup HR App
  command: "{{ java_cmd }} console iiqBeans -c \"import setup.xml\""
  args:
    chdir: /var/tmp/HR
    stdin: |
      {{ iiq_admin_user }}
      {{ iiq_admin_password }}
  async: 1200
  poll: 5
  register: cmdout
  changed_when: cmdout.rc != 0

- name: Setup LDAP App
  command: "{{ java_cmd }} console iiqBeans -c \"import setup.xml\""
  args:
    chdir: /var/tmp/EnterpriseDirectory
    stdin: |
      {{ iiq_admin_user }}
      {{ iiq_admin_password }}
  async: 1200
  poll: 5
  register: out
  changed_when: out.rc != 0


# - name: Import SERI Identity ObjectConfig
